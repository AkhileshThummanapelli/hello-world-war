pipeline {
    parameters {
  choice choices: ['main', 'dev', 'stg', 'prod'], 
  description: 'Select any Branch',
  name: 'Branch'
}
   agent {
  label 'akhilesh_slave'
}

   environment {
  PATH = "/opt/maven/bin:$PATH"
}

    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
        stage('Checkout') {
            steps {
                checkout([$class: 'GitSCM',
                branches: [
                    [
                        name: "*/${Branch}"
                        ]
                        ], 
                        extensions: 
                        [
                            ], 
                            userRemoteConfigs: [
                                [
                                    url: 'https://github.com/AkhileshThummanapelli/hello-world-war.git'
                                    ]
                                    ]
                                    ])
            }
        }
        stage('Build') {
            steps {
                sh 'mvn package'
            }
        }
        stage('Nexus Artifact Upload') {
            steps {
                script{
                    def mavenpom = readMavenPom file: 'pom.xml'
                      nexusArtifactUploader artifacts: 
                [
                    [
                        artifactId: 'hello-world-war', 
                        classifier:'',
                        file: 
                        "target/hello-world-war-${mavenpom.version}.war", 
                        type: 'war'
                    ]
                ], 
                        credentialsId: 'Nexus-cred', 
                        groupId: 'com.efsavage', 
                        nexusUrl: '3.6.122.180:8081', 
                        nexusVersion: 
                        'nexus3', 
                        protocol: 'http', 
                        repository: 'akhilesh_repo', 
                        version: "${mavenpom.version}"
                    }
                }
        }
        stage('Deploy') {
            steps {
                deploy adapters: 
                [
                    tomcat8
                    (
                        credentialsId: 'Akhilesh_Tomcat',
                        path: '',
                        url: 'http://15.207.58.204:8085/'
                    )
                ],
                contextPath: 'pipe',
                war: '**/*.war'
            }
        }
    }
}
